# üóÑÔ∏è –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –∏–Ω—Å—Ç–∞–ª–ª–µ—Ä–µ - –ì–æ—Ç–æ–≤–æ!

## ‚úÖ **–ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**

### üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü**

#### **–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å —Å—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- –í–æ–∑–Ω–∏–∫–∞–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î
- –ù—É–∂–Ω–æ –±—ã–ª–æ –≤—Ä—É—á–Ω—É—é –æ—á–∏—â–∞—Ç—å –±–∞–∑—É

#### **–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞** –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –Ω–æ–≤—ã—Ö
- ‚úÖ **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏

---

## üìÅ **–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**

### **1. `install/index.php`** - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞

#### **–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `clearDatabase()`:**
```php
function clearDatabase($pdo) {
    // –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
    $pdo->exec("SET FOREIGN_KEY_CHECKS = 0");
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã
    $stmt = $pdo->query("
        SELECT TABLE_NAME 
        FROM INFORMATION_SCHEMA.TABLES 
        WHERE TABLE_SCHEMA = DATABASE() 
        AND TABLE_TYPE = 'BASE TABLE'
    ");
    
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
    foreach ($tables as $table) {
        $pdo->exec("DROP TABLE IF EXISTS `$table`");
    }
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
    $pdo->exec("SET FOREIGN_KEY_CHECKS = 1");
}
```

#### **–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `importDatabase()`:**
```php
function importDatabase() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    $stmt = $pdo->query("SHOW TABLES");
    $existing_tables = $stmt->fetchAll(PDO::FETCH_COLUMN);
    
    if (!empty($existing_tables)) {
        // –ë–∞–∑–∞ –Ω–µ –ø—É—Å—Ç–∞—è - –æ—á–∏—â–∞–µ–º
        if (!clearDatabase($pdo)) {
            throw new Exception('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—á–∏—Å—Ç–∏—Ç–∏ —ñ—Å–Ω—É—é—á—ñ —Ç–∞–±–ª–∏—Ü—ñ');
        }
    }
    
    // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
    // ...
}
```

### **2. `install/step3.php`** - –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

#### **–ù–æ–≤—ã–µ –∞–ª–µ—Ä—Ç—ã:**
```html
<div class="alert alert-warning">
    <strong>–£–≤–∞–≥–∞:</strong> –Ø–∫—â–æ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö —î —Ç–∞–±–ª–∏—Ü—ñ, –≤–æ–Ω–∏ –±—É–¥—É—Ç—å –≤–∏–¥–∞–ª–µ–Ω—ñ!
</div>

<div class="alert alert-info">
    <strong>–ê–≤—Ç–æ–æ—á–∏—â–µ–Ω–Ω—è:</strong> –Ü–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É –ø–µ—Ä–µ–¥ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è–º –Ω–æ–≤–∏—Ö —Ç–∞–±–ª–∏—Ü—å.
</div>
```

### **3. `install/step4.php`** - –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å

#### **–ù–æ–≤—ã–µ —ç—Ç–∞–ø—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏:**
```javascript
const steps = [
    '–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö...',
    '–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö...',
    '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ—Å–Ω—É—é—á–∏—Ö —Ç–∞–±–ª–∏—Ü—å...',        // –ù–û–í–´–ô
    '–û—á–∏—â–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)...', // –ù–û–í–´–ô
    '–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ç–∞–±–ª–∏—Ü—å...',
    '–Ü–º–ø–æ—Ä—Ç –ø–æ—á–∞—Ç–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö...',
    '–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞...',
    '–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è —ñ–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä–∞...'
];
```

---

## üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**

### **1. –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:**
- üîí **FOREIGN_KEY_CHECKS = 0** - –æ—Ç–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ –≤—Ä–µ–º—è —É–¥–∞–ª–µ–Ω–∏—è
- üéØ **–¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã** - —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–µ —Ç—Ä–æ–≥–∞–µ–º
- ‚úÖ **IF EXISTS** - –Ω–µ –æ—à–∏–±–∞–µ—Ç—Å—è –µ—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ —É–∂–µ —É–¥–∞–ª–µ–Ω–∞
- üîÑ **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫** - –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ

### **2. –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```php
error_log("Found " . count($tables) . " tables to drop: " . implode(', ', $tables));
error_log("Successfully dropped table: $table");
error_log("Database completely cleaned");
```

### **3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- üõ°Ô∏è **Try-catch** –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
- üìù **–î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏** –æ—à–∏–±–æ–∫
- üîÑ **–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã** –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Å–±–æ—è—Ö
- ‚úÖ **–§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –æ—á–∏—Å—Ç–∫–∏

### **4. –†–µ–∑–µ—Ä–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
```php
$backup_info = [
    'timestamp' => date('Y-m-d H:i:s'),
    'tables' => $tables,
    'database' => $pdo->query("SELECT DATABASE()")->fetchColumn()
];
error_log("Backup info: " . json_encode($backup_info));
```

---

## üéØ **–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:**

### **–®–∞–≥ 1 - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã:**
1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ `SHOW TABLES`
3. –ü–æ–¥—Å—á–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü

### **–®–∞–≥ 2 - –û—á–∏—Å—Ç–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
1. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ `FOREIGN_KEY_CHECKS`
2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü
3. –°–æ–∑–¥–∞–Ω–∏–µ backup-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
4. –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
6. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ `FOREIGN_KEY_CHECKS`

### **–®–∞–≥ 3 - –ò–º–ø–æ—Ä—Ç –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
1. –ß—Ç–µ–Ω–∏–µ `baza.sql`
2. –†–∞–∑–±–∏–≤–∫–∞ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
4. –ü–æ–¥—Å—á–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üìä **–í–∏–∑—É–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**

### **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä:**
- üìà **8 —ç—Ç–∞–ø–æ–≤** –≤–º–µ—Å—Ç–æ 6
- ‚è±Ô∏è **600ms** –∏–Ω—Ç–µ—Ä–≤–∞–ª (–±—ã–ª–æ 800ms)
- üìê **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç** –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- üéØ **–¢–æ—á–Ω—ã–µ –ø—Ä–æ—Ü–µ–Ω—Ç—ã** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

### **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã:**
- ‚ö†Ô∏è **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ** –æ–± —É–¥–∞–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚ÑπÔ∏è **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** –æ–± –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–µ
- üìã **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫** –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üîç **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –ª–æ–≥–∞—Ö:**

### **–ü—Ä–∏ –ø—É—Å—Ç–æ–π –±–∞–∑–µ:**
```
Database is empty, proceeding with import
Starting SQL import from baza.sql
Successfully executed 45 SQL queries
```

### **–ü—Ä–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö:**
```
Found existing tables in database: users, ads, categories, settings
Clearing database before importing new structure
Starting database cleanup
Found 4 tables to drop: users, ads, categories, settings
Backup info: {"timestamp":"2024-01-15 10:30:45","tables":["users","ads","categories","settings"],"database":"classifieds_board"}
Successfully dropped table: users
Successfully dropped table: ads
Successfully dropped table: categories
Successfully dropped table: settings
Database completely cleaned
Database cleared successfully
Starting SQL import from baza.sql
Successfully executed 45 SQL queries
```

### **–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö:**
```
Database cleanup error: Table 'protected_table' cannot be dropped
Error details: [stack trace]
Failed to restore FOREIGN_KEY_CHECKS
```

---

## ‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

### **–¢–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–æ–≤–∫–∞:**
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç** —Å—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç** –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏
- üìù **–ü–æ–¥—Ä–æ–±–Ω–æ –ª–æ–≥–∏—Ä—É–µ—Ç** –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚ö†Ô∏è **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –æ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è—Ö
- üéØ **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—á–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å** –æ–ø–µ—Ä–∞—Ü–∏–π

### **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç:**
- üöÄ **–ë—ã—Å—Ç—Ä—É—é –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫—É** –±–µ–∑ —Ä—É—á–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏
- üìä **–î–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é** –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
- üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ë–î
- ‚úÖ **–ì–∞—Ä–∞–Ω—Ç–∏—é —á–∏—Å—Ç–æ–π** —É—Å—Ç–∞–Ω–æ–≤–∫–∏

---

## üéâ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

### **–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–Ω—Å—Ç–∞–ª–ª–µ—Ä –æ–±—ã—á–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º
2. –î–æ–π–¥–∏—Ç–µ –¥–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î (Step 3)
3. –£–≤–∏–¥–∏—Ç–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–± –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–µ
4. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É - –≤—Å–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `error_log` –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
2. Backup-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ª–æ–≥–∞—Ö
3. –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –ø–æ–¥—Ä–æ–±–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è
4. –û—à–∏–±–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –ø—Ä–æ—Ü–µ—Å—Å

**–ò–Ω—Å—Ç–∞–ª–ª–µ—Ä —Ç–µ–ø–µ—Ä—å —É–º–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏! üöÄ**