class a{constructor(){this.isOpen=!1,this.startX=0,this.startY=0,this.currentX=0,this.currentY=0,this.isDragging=!1,this.velocity=0,this.lastX=0,this.lastTime=0,this.EDGE_THRESHOLD=20,this.SWIPE_THRESHOLD=50,this.VELOCITY_THRESHOLD=.3,this.init()}init(){this.bindEvents(),this.setupHammerJS()}bindEvents(){document.addEventListener("touchstart",this.handleGlobalTouchStart.bind(this),{passive:!1}),document.addEventListener("touchmove",this.handleGlobalTouchMove.bind(this),{passive:!1}),document.addEventListener("touchend",this.handleGlobalTouchEnd.bind(this),{passive:!1}),document.addEventListener("keydown",this.handleKeydown.bind(this)),window.addEventListener("resize",this.handleResize.bind(this)),document.addEventListener("focusin",this.handleFocusTrap.bind(this))}setupHammerJS(){if(typeof Hammer<"u"){const e=document.querySelector(".glass-sidebar");if(e){const t=new Hammer(e);t.get("swipe").set({direction:Hammer.DIRECTION_HORIZONTAL}),t.on("swipeleft",()=>this.closeSidebar())}}}handleGlobalTouchStart(e){this.startX=e.touches[0].clientX,this.startY=e.touches[0].clientY,this.lastX=this.startX,this.lastTime=Date.now(),this.isDragging=!1,!this.isOpen&&this.startX<=this.EDGE_THRESHOLD&&(this.isDragging=!0,document.body.style.userSelect="none")}handleGlobalTouchMove(e){if(!this.isDragging&&!this.isOpen)return;this.currentX=e.touches[0].clientX,this.currentY=e.touches[0].clientY;const t=this.currentX-this.startX,s=Math.abs(this.currentY-this.startY),n=Date.now(),o=n-this.lastTime;o>0&&(this.velocity=(this.currentX-this.lastX)/o),Math.abs(t)>s&&Math.abs(t)>10&&e.preventDefault(),!this.isOpen&&this.startX<=this.EDGE_THRESHOLD&&t>30&&(this.openSidebar(),this.isDragging=!1),this.isOpen&&t<-this.SWIPE_THRESHOLD&&this.closeSidebar(),this.lastX=this.currentX,this.lastTime=n}handleGlobalTouchEnd(e){!this.isDragging&&!this.isOpen||(this.currentX-this.startX,Math.abs(this.velocity)>this.VELOCITY_THRESHOLD&&(this.velocity>0&&!this.isOpen&&this.startX<=this.EDGE_THRESHOLD?this.openSidebar():this.velocity<0&&this.isOpen&&this.closeSidebar()),this.isDragging=!1,document.body.style.userSelect="",this.velocity=0)}handleKeydown(e){e.key==="Escape"&&this.isOpen&&this.closeSidebar(),e.key==="Tab"&&this.isOpen&&this.trapFocus(e)}handleResize(){window.innerWidth>=1024&&this.isOpen&&this.closeSidebar()}handleFocusTrap(e){if(!this.isOpen)return;const t=document.querySelector(".glass-sidebar");if(t&&!t.contains(e.target)){const s=t.querySelector('button, a, input, select, textarea, [tabindex]:not([tabindex="-1"])');s&&s.focus()}}trapFocus(e){const t=document.querySelector(".glass-sidebar");if(!t)return;const s=t.querySelectorAll('button:not([disabled]), a[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'),n=s[0],o=s[s.length-1];e.shiftKey&&document.activeElement===n?(e.preventDefault(),o.focus()):!e.shiftKey&&document.activeElement===o&&(e.preventDefault(),n.focus())}openSidebar(){if(this.isOpen=!0,document.body.style.overflow="hidden",window.Alpine){const e=document.querySelector('[x-data*="sidebarOpen"]');e&&e._x_dataStack&&(e._x_dataStack[0].sidebarOpen=!0)}setTimeout(()=>{const e=document.querySelector(".glass-sidebar"),t=e==null?void 0:e.querySelector("button:not([disabled]), a[href]");t==null||t.focus()},100),this.trackEvent("sidebar_opened","swipe")}closeSidebar(){if(this.isOpen=!1,document.body.style.overflow="",window.Alpine){const e=document.querySelector('[x-data*="sidebarOpen"]');e&&e._x_dataStack&&(e._x_dataStack[0].sidebarOpen=!1)}setTimeout(()=>{const e=document.querySelector(".floating-menu-btn");e==null||e.focus()},200),this.trackEvent("sidebar_closed","swipe")}trackEvent(e,t){typeof gtag<"u"&&gtag("event",e,{event_category:"navigation",event_label:t,value:1}),window.analytics&&typeof window.analytics.track=="function"&&window.analytics.track(e,{method:t,timestamp:Date.now()})}toggle(){this.isOpen?this.closeSidebar():this.openSidebar()}destroy(){document.removeEventListener("touchstart",this.handleGlobalTouchStart),document.removeEventListener("touchmove",this.handleGlobalTouchMove),document.removeEventListener("touchend",this.handleGlobalTouchEnd),document.removeEventListener("keydown",this.handleKeydown),window.removeEventListener("resize",this.handleResize),document.removeEventListener("focusin",this.handleFocusTrap)}}document.addEventListener("DOMContentLoaded",()=>{window.innerWidth<1024&&(window.touchSidebar=new a)});window.addEventListener("resize",()=>{window.innerWidth<1024&&!window.touchSidebar?window.touchSidebar=new a:window.innerWidth>=1024&&window.touchSidebar&&(window.touchSidebar.destroy(),window.touchSidebar=null)});document.addEventListener("alpine:init",()=>{Alpine.data("touchSidebar",()=>({sidebarOpen:!1,openSidebar(){this.sidebarOpen=!0,document.body.style.overflow="hidden",window.touchSidebar&&(window.touchSidebar.isOpen=!0),setTimeout(()=>{const i=document.querySelector(".glass-sidebar"),e=i==null?void 0:i.querySelector("button:not([disabled]), a[href]");e==null||e.focus()},100)},closeSidebar(){this.sidebarOpen=!1,document.body.style.overflow="",window.touchSidebar&&(window.touchSidebar.isOpen=!1),setTimeout(()=>{const i=document.querySelector(".floating-menu-btn");i==null||i.focus()},200)},toggle(){this.sidebarOpen?this.closeSidebar():this.openSidebar()}}))});
